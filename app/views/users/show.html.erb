<%= render("shared/header") %>

<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-8">
      <div class="text-black-50 fs-1 text-center fw-bold">出欠登録ページ</div>
    </div>  
  </div>
</div>

<% if ["登録しました", "全ての欄を入力してください", "無効な生徒IDです"].include?(flash[:notice]) %>
    <div class="bg-orange text-center fs-4 col-7 mx-auto mb-4">
        <span class="align-middle text-primary"><%= flash[:notice] %></span>
    </div>
<% end %>

<div class="row col-11 mx-auto justify-content-between">
  <%= form_with( url: attendances_path, mothod: :post, local: true, class: "col-lg-4 col-8 mx-auto") do |f| %>
    <div class="col-12 mb-3">
        <%= f.label :student_id, "生徒id" %>
        <%= f.text_field :student_id, class: "form-control" %>
    </div>
    <div class="col-12 mb-3">
        <%= f.label :name, "氏名" %>
        <%= f.text_field :name, class: "form-control" %>
    </div>    
    <div class="col-12 mb-3">
      <%= f.label :status, "出欠席を登録" %>
      <select name="status" class="form-select form-control" aria-label="Default select example">
          <option selected>選択してください</option>
          <option value="欠席">欠席</option>
          <option value="遅刻">遅刻</option>
          <option value="早退">早退</option>
          <option value="公欠">公欠</option>
          <option value="忌引き">忌引き</option>
          <option value="その他">その他</option>
      </select>
    </div>
    <div class="col-12 mb-3">
        <%= f.label :start_time, "日付" %>
        <%= f.date_field :start_time, class: "form-control" %>
    </div>
    <div class="col-12 mb-3">
        <%= f.label :reason, "理由" %>
        <%= f.text_field :reason, class: "form-control", style: "height: 100px" %>
    </div>
    <%= f.hidden_field :user_id, value: params[:id] %>
    <div class="col-12 text-center mb-5">
        <%= f.submit "出欠を登録", class: "btn btn-primary col-6" %>
    </div>
  <% end %>
  
  <div class="col-lg-8 col-12 ps-lg-5">
    <%= week_calendar events: @attendances do |date, attendances| %>
      <div class="text-center p-1 mb-3 date-days">
        <%= date.day %>
      </div>
      <%# Statusの数値を更新 %>
      <% status_1, status_2, status_3, status_4, status_5, status_6 = 0, 0, 0, 0, 0, 0 %>
      <% attendances.each do |attendance| %>
        <% status_1 += 1 if attendance.status == "欠席" %>
        <% status_2 += 1 if attendance.status == "遅刻" %>
        <% status_3 += 1 if attendance.status == "早退" %>
        <% status_4 += 1 if attendance.status == "公欠" %>
        <% status_5 += 1 if attendance.status == "忌引き" %>
        <% status_6 += 1 if attendance.status == "その他" %>
      <% end %>
        <div>
          <p class="status-number <%= 'status-true' if status_1 != 0 %>">欠：<%= status_1 %>件</p>
          <p class="status-number <%= 'status-true' if status_2 != 0 %>">遅：<%= status_2 %>件</p>
          <p class="status-number <%= 'status-true' if status_3 != 0 %>">早：<%= status_3 %>件</p>
          <p class="status-number <%= 'status-true' if status_4 != 0 %>">公：<%= status_4 %>件</p>
          <p class="status-number <%= 'status-true' if status_5 != 0 %>">忌：<%= status_5 %>件</p>
          <p class="status-number <%= 'status-true' if status_6 != 0 %>">他：<%= status_6 %>件</p>
          <%= render(partial: "shared/modal", locals: {attendances: attendances, date: date}) %>
        </div>
    <% end %>
    <%= pie_chart [["Work", 320], ["Play", 1492], ["aaa", 700], ["bbb", 1200]] %>
  </div>
</div>
